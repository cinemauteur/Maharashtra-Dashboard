<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Maharashtra Export Dashboard</title>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans:wght@300;400;500;600;700&family=Noto+Sans+Mono:wght@400;500&display=swap" rel="stylesheet"/>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<style>
  :root {
    --navy:#003366;--navy-dark:#002244;--navy-light:#e8eef6;
    --orange:#f15a22;--orange-lt:#fff2ec;--saffron:#ff9933;
    --green-ind:#138808;--white:#ffffff;--bg:#f0f4f8;
    --surface:#ffffff;--border:#d0dae8;--text:#1a2940;--muted:#5a6e88;
    --green:#1a7a2e;--green-bg:#e8f5eb;--red:#c0392b;--red-bg:#fdecea;
    --shadow:0 2px 12px rgba(0,51,102,0.10);--shadow-lg:0 4px 24px rgba(0,51,102,0.13);
  }
  *{margin:0;padding:0;box-sizing:border-box;}
  body{font-family:'Noto Sans',sans-serif;background:var(--bg);color:var(--text);min-height:100vh;font-size:13px;}
  .tricolor-strip{height:4px;background:linear-gradient(90deg,var(--saffron) 33.3%,#fff 33.3%,#fff 66.6%,var(--green-ind) 66.6%);}
  .header{background:var(--navy);padding:0 28px;display:flex;align-items:center;height:64px;gap:16px;box-shadow:0 2px 8px rgba(0,0,0,0.25);}
  .header-emblem{width:44px;height:44px;background:#fff;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:22px;flex-shrink:0;box-shadow:0 2px 6px rgba(0,0,0,0.2);}
  .header-title-main{font-size:16px;font-weight:700;color:#fff;letter-spacing:0.5px;}
  .header-subtitle{font-size:11px;color:rgba(255,255,255,0.65);margin-top:1px;}
  .header-right{text-align:right;font-size:11px;color:rgba(255,255,255,0.6);line-height:1.6;margin-left:auto;}
  .header-right span{color:var(--saffron);font-weight:600;}
  .ticker-bar{background:var(--navy-dark);color:rgba(255,255,255,0.9);font-size:12px;padding:5px 0;overflow:hidden;white-space:nowrap;border-bottom:2px solid var(--orange);}
  .ticker-label{background:var(--orange);color:#fff;font-weight:700;font-size:11px;padding:3px 10px;display:inline-block;margin-right:12px;}
  .ticker-inner{display:inline-block;animation:ticker 35s linear infinite;}
  @keyframes ticker{from{transform:translateX(0);}to{transform:translateX(-100%);}}
  .filter-bar{background:var(--surface);border-bottom:2px solid var(--border);padding:12px 28px;display:flex;align-items:flex-end;gap:16px;flex-wrap:wrap;box-shadow:var(--shadow);}
  .filter-label-top{font-size:10px;font-weight:700;color:var(--navy);text-transform:uppercase;letter-spacing:0.8px;margin-bottom:4px;}
  .filter-select{border:1.5px solid var(--border);border-radius:5px;background:#fff;color:var(--text);font-family:'Noto Sans',sans-serif;font-size:12px;padding:7px 28px 7px 10px;appearance:none;cursor:pointer;min-width:165px;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 24 24' fill='none' stroke='%23003366' stroke-width='2.5'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right 9px center;transition:border-color 0.2s;}
  .filter-select:focus{outline:none;border-color:var(--navy);box-shadow:0 0 0 3px rgba(0,51,102,0.1);}
  .btn-apply{background:var(--orange);color:#fff;border:none;border-radius:5px;padding:8px 22px;font-family:'Noto Sans',sans-serif;font-size:12px;font-weight:700;cursor:pointer;box-shadow:0 2px 6px rgba(241,90,34,0.3);transition:background 0.2s;}
  .btn-apply:hover{background:#d44e1a;}
  .btn-reset{background:#fff;color:var(--navy);border:1.5px solid var(--border);border-radius:5px;padding:7px 16px;font-family:'Noto Sans',sans-serif;font-size:12px;font-weight:600;cursor:pointer;transition:border-color 0.2s;}
  .btn-reset:hover{border-color:var(--navy);}
  .view-tabs{margin-left:auto;display:flex;border:1.5px solid var(--border);border-radius:5px;overflow:hidden;background:#fff;}
  .view-tab{padding:7px 18px;font-size:12px;font-weight:600;cursor:pointer;color:var(--muted);border:none;background:transparent;font-family:'Noto Sans',sans-serif;border-right:1px solid var(--border);transition:background 0.15s,color 0.15s;}
  .view-tab:last-child{border-right:none;}
  .view-tab.active{background:var(--navy);color:#fff;}
  .view-tab:not(.active):hover{background:var(--navy-light);color:var(--navy);}
  .breadcrumb{padding:7px 28px;font-size:11px;color:var(--muted);background:var(--navy-light);border-bottom:1px solid var(--border);}
  .breadcrumb span{color:var(--navy);font-weight:600;}
  .main{padding:18px 28px;display:flex;flex-direction:column;gap:16px;}
  .kpi-row{display:grid;grid-template-columns:repeat(auto-fit,minmax(190px,1fr));gap:14px;}
  .kpi-card{background:var(--surface);border:1px solid var(--border);border-radius:8px;padding:16px 18px;border-top:3px solid var(--accent-color,#003366);box-shadow:var(--shadow);transition:box-shadow 0.2s,transform 0.2s;position:relative;overflow:hidden;}
  .kpi-card:hover{box-shadow:var(--shadow-lg);transform:translateY(-2px);}
  .kpi-label{font-size:10px;font-weight:700;color:var(--muted);text-transform:uppercase;letter-spacing:0.8px;margin-bottom:8px;}
  .kpi-value{font-size:26px;font-weight:700;font-family:'Noto Sans Mono',monospace;color:var(--navy);line-height:1;}
  .kpi-sub{font-size:11px;color:var(--muted);margin-top:5px;}
  .kpi-badge{display:inline-flex;align-items:center;gap:3px;font-size:11px;font-weight:700;padding:2px 8px;border-radius:3px;margin-top:6px;}
  .kpi-badge.up{background:var(--green-bg);color:var(--green);}
  .kpi-badge.down{background:var(--red-bg);color:var(--red);}
  .kpi-icon{position:absolute;top:14px;right:16px;font-size:28px;opacity:0.1;}
  .content-grid{display:grid;grid-template-columns:1fr 320px;gap:16px;}
  .left-col{display:flex;flex-direction:column;gap:16px;}
  .right-col{display:flex;flex-direction:column;gap:16px;}
  .panel{background:var(--surface);border:1px solid var(--border);border-radius:8px;overflow:hidden;box-shadow:var(--shadow);}
  .panel-header{padding:11px 18px;background:var(--navy);display:flex;align-items:center;justify-content:space-between;}
  .panel-title{font-size:12px;font-weight:700;color:#fff;letter-spacing:0.3px;}
  .panel-badge{font-size:10px;color:rgba(255,255,255,0.7);background:rgba(255,255,255,0.12);padding:2px 8px;border-radius:20px;font-weight:600;}
  .panel-body{padding:14px 18px;}
  .chart-wrap{position:relative;height:210px;}
  .map-area{background:var(--navy-light);border-radius:6px;display:flex;align-items:center;justify-content:center;min-height:270px;border:1px solid var(--border);overflow:hidden;}
  .map-area svg{max-height:270px;width:100%;}
  .table-wrap{overflow-x:auto;}
  table{width:100%;border-collapse:collapse;font-size:12px;}
  thead th{padding:9px 12px;text-align:left;color:#fff;font-size:10px;font-weight:700;text-transform:uppercase;letter-spacing:0.6px;background:var(--navy);border-right:1px solid rgba(255,255,255,0.1);white-space:nowrap;}
  thead th:last-child{border-right:none;}
  thead th.num{text-align:right;}
  tbody tr{border-bottom:1px solid #e8eef6;transition:background 0.12s;}
  tbody tr:nth-child(even){background:#f7fafd;}
  tbody tr:hover{background:var(--navy-light);}
  tbody td{padding:8px 12px;color:var(--text);}
  tbody td.num{text-align:right;font-family:'Noto Sans Mono',monospace;font-size:12px;}
  .rank-badge{display:inline-flex;align-items:center;justify-content:center;width:22px;height:22px;border-radius:4px;font-size:10px;font-weight:700;margin-right:4px;background:var(--navy-light);color:var(--navy);}
  .rank-badge.top1{background:#fff3cd;color:#856404;}
  .rank-badge.top2{background:#e2e8f0;color:#475569;}
  .rank-badge.top3{background:#fde8e8;color:#9b1c1c;}
  .growth-chip{display:inline-flex;align-items:center;font-size:11px;font-weight:700;padding:2px 7px;border-radius:3px;font-family:'Noto Sans Mono',monospace;}
  .growth-chip.pos{background:var(--green-bg);color:var(--green);}
  .growth-chip.neg{background:var(--red-bg);color:var(--red);}
  .share-bar-wrap{display:flex;align-items:center;gap:6px;}
  .share-bar-bg{flex:1;height:5px;background:var(--navy-light);border-radius:3px;min-width:50px;}
  .share-bar-fill{height:100%;border-radius:3px;background:linear-gradient(90deg,var(--navy),var(--orange));}
  .product-item{display:flex;align-items:center;padding:7px 0;border-bottom:1px solid #edf2f7;}
  .product-item:last-child{border-bottom:none;}
  .product-color-bar{width:4px;height:28px;border-radius:2px;margin-right:10px;flex-shrink:0;}
  .product-name{flex:1;font-size:12px;color:var(--text);font-weight:500;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;}
  .product-val{font-family:'Noto Sans Mono',monospace;font-size:11px;color:var(--muted);margin-left:8px;}
  .product-share{font-size:11px;font-weight:700;color:var(--orange);margin-left:8px;min-width:38px;text-align:right;}
  .loading{display:flex;align-items:center;justify-content:center;height:60px;color:var(--muted);font-size:12px;gap:8px;}
  .spinner{width:16px;height:16px;border:2px solid var(--border);border-top-color:var(--navy);border-radius:50%;animation:spin 0.7s linear infinite;}
  @keyframes spin{to{transform:rotate(360deg);}}
  .footer{background:var(--navy-dark);color:rgba(255,255,255,0.45);text-align:center;font-size:10px;padding:10px;margin-top:16px;letter-spacing:0.3px;}
  .footer span{color:var(--saffron);}
  @media(max-width:900px){.content-grid{grid-template-columns:1fr;}.header-right{display:none;}}
</style>
</head>
<body>
<div class="tricolor-strip"></div>
<div class="header">
  <div class="header-emblem">üèõÔ∏è</div>
  <div>
    <div class="header-title-main">MAHARASHTRA EXPORT DASHBOARD</div>
    <div class="header-subtitle">District & Region-wise Export Trade Analysis ¬∑ Government of Maharashtra</div>
  </div>
  <div class="header-right">
    <div>Financial Year <span>2025‚Äì26</span></div>
    <div>Period: <span>Apr ‚Äì Dec 2025</span></div>
    <div id="last-updated" style="color:rgba(255,255,255,0.35);font-size:10px;margin-top:2px;"></div>
  </div>
</div>
<div class="ticker-bar">
  <span class="ticker-label">LIVE</span>
  <span class="ticker-inner" id="ticker-text">Loading regional data...</span>
</div>
<div class="filter-bar">
  <div><div class="filter-label-top">üìç Region / Division</div><select class="filter-select" id="filter-region"><option>Loading...</option></select></div>
  <div><div class="filter-label-top">üèôÔ∏è District</div><select class="filter-select" id="filter-district"><option>Loading...</option></select></div>
  <div><div class="filter-label-top">üì¶ Commodity</div><select class="filter-select" id="filter-product"><option>Loading...</option></select></div>
  <button class="btn-apply" onclick="applyFilters()">‚ñ∂ Submit</button>
  <button class="btn-reset" onclick="resetFilters()">‚Ü∫ Reset</button>
  <div class="view-tabs">
    <button class="view-tab active" onclick="switchView('overview',this)">Overview</button>
    <button class="view-tab" onclick="switchView('districts',this)">Districts / UT</button>
    <button class="view-tab" onclick="switchView('products',this)">Commodity</button>
  </div>
</div>
<div class="breadcrumb">üè† Home &nbsp;‚Ä∫&nbsp; <span>Maharashtra</span> &nbsp;‚Ä∫&nbsp; <span id="bc-region">All Regions</span> &nbsp;‚Ä∫&nbsp; <span id="bc-district">All Districts</span></div>
<div class="main">
  <div class="kpi-row">
    <div class="kpi-card" style="--accent-color:#003366;"><div class="kpi-icon">üìä</div><div class="kpi-label">Total Export Value (Apr‚ÄìDec '25)</div><div class="kpi-value" id="kpi-total">‚Äî</div><div class="kpi-sub">‚Çπ in Millions ¬∑ Maharashtra State</div></div>
    <div class="kpi-card" style="--accent-color:#f15a22;"><div class="kpi-icon">üìÖ</div><div class="kpi-label">Dec 2025 Export Value</div><div class="kpi-value" id="kpi-latest">‚Äî</div><div id="kpi-growth-badge"></div></div>
    <div class="kpi-card" style="--accent-color:#138808;"><div class="kpi-icon">üó∫Ô∏è</div><div class="kpi-label">Active Districts</div><div class="kpi-value" id="kpi-districts">‚Äî</div><div class="kpi-sub">Reporting Export Activity</div></div>
    <div class="kpi-card" style="--accent-color:#ff9933;"><div class="kpi-icon">üì¶</div><div class="kpi-label">Commodity Categories</div><div class="kpi-value" id="kpi-products">‚Äî</div><div class="kpi-sub">Unique Products / Commodities</div></div>
  </div>

  <div id="view-overview">
    <div class="content-grid">
      <div class="left-col">
        <div class="panel">
          <div class="panel-header"><span class="panel-title">üìà Monthly Export Trend ‚Äî Value (‚Çπ Mn)</span><span class="panel-badge">Apr ‚Äì Dec 2025</span></div>
          <div class="panel-body"><div class="chart-wrap"><canvas id="chart-trend"></canvas></div></div>
        </div>
        <div class="panel">
          <div class="panel-header"><span class="panel-title">üó∫Ô∏è Region-wise Export Summary ‚Äî Value ¬∑ Share</span><span class="panel-badge">7 Regions</span></div>
          <div class="table-wrap">
            <table>
              <thead><tr><th>#</th><th>Region / Division</th><th class="num">Total Apr‚ÄìDec (‚Çπ Mn)</th><th class="num">Dec '25</th><th class="num">Nov '25</th><th class="num">MoM Growth %</th><th class="num">% Share</th></tr></thead>
              <tbody id="region-table-body"><tr><td colspan="7"><div class="loading"><div class="spinner"></div>Loading...</div></td></tr></tbody>
            </table>
          </div>
        </div>
      </div>
      <div class="right-col">
        <div class="panel">
          <div class="panel-header"><span class="panel-title">üó∫Ô∏è Geographical Overview</span><span class="panel-badge">Maharashtra ¬∑ India</span></div>
          <div class="panel-body" style="padding:10px;">
            <div class="map-area">
              <svg viewBox="0 0 500 400" xmlns="http://www.w3.org/2000/svg">
                <rect width="500" height="400" fill="#e8eef6"/>
                <ellipse cx="160" cy="110" rx="72" ry="52" fill="#003366" fill-opacity="0.78" stroke="#fff" stroke-width="1.5"/>
                <text x="160" y="106" text-anchor="middle" fill="#fff" font-size="9" font-family="Noto Sans" font-weight="700">NASHIK</text>
                <text x="160" y="119" text-anchor="middle" fill="rgba(255,255,255,0.8)" font-size="8" font-family="Noto Sans">REGION</text>
                <ellipse cx="320" cy="95" rx="78" ry="52" fill="#f15a22" fill-opacity="0.85" stroke="#fff" stroke-width="1.5"/>
                <text x="320" y="91" text-anchor="middle" fill="#fff" font-size="9" font-family="Noto Sans" font-weight="700">AMRAVATI</text>
                <text x="320" y="104" text-anchor="middle" fill="rgba(255,255,255,0.8)" font-size="8" font-family="Noto Sans">REGION</text>
                <ellipse cx="432" cy="115" rx="58" ry="48" fill="#138808" fill-opacity="0.82" stroke="#fff" stroke-width="1.5"/>
                <text x="432" y="111" text-anchor="middle" fill="#fff" font-size="9" font-family="Noto Sans" font-weight="700">NAGPUR</text>
                <text x="432" y="124" text-anchor="middle" fill="rgba(255,255,255,0.8)" font-size="8" font-family="Noto Sans">REGION</text>
                <ellipse cx="285" cy="200" rx="82" ry="52" fill="#ff9933" fill-opacity="0.85" stroke="#fff" stroke-width="1.5"/>
                <text x="285" y="194" text-anchor="middle" fill="#fff" font-size="8" font-family="Noto Sans" font-weight="700">CHH. SAMBHAJI</text>
                <text x="285" y="207" text-anchor="middle" fill="rgba(255,255,255,0.8)" font-size="8" font-family="Noto Sans">NAGAR REGION</text>
                <ellipse cx="155" cy="240" rx="78" ry="57" fill="#0070c0" fill-opacity="0.78" stroke="#fff" stroke-width="1.5"/>
                <text x="155" y="236" text-anchor="middle" fill="#fff" font-size="9" font-family="Noto Sans" font-weight="700">PUNE</text>
                <text x="155" y="249" text-anchor="middle" fill="rgba(255,255,255,0.8)" font-size="8" font-family="Noto Sans">REGION</text>
                <ellipse cx="60" cy="275" rx="44" ry="82" fill="#6f42c1" fill-opacity="0.75" stroke="#fff" stroke-width="1.5"/>
                <text x="60" y="271" text-anchor="middle" fill="#fff" font-size="9" font-family="Noto Sans" font-weight="700">KONKAN</text>
                <text x="60" y="284" text-anchor="middle" fill="rgba(255,255,255,0.8)" font-size="8" font-family="Noto Sans">REGION</text>
                <ellipse cx="76" cy="165" rx="40" ry="36" fill="#dc3545" fill-opacity="0.85" stroke="#fff" stroke-width="1.5"/>
                <text x="76" y="161" text-anchor="middle" fill="#fff" font-size="8" font-family="Noto Sans" font-weight="700">MUMBAI</text>
                <text x="76" y="174" text-anchor="middle" fill="rgba(255,255,255,0.8)" font-size="8" font-family="Noto Sans">REGION</text>
                <rect x="0" y="362" width="500" height="38" fill="#fff" fill-opacity="0.92"/>
                <text x="10" y="376" fill="#5a6e88" font-size="8" font-family="Noto Sans" font-weight="700">LEGEND:</text>
                <circle cx="62" cy="373" r="5" fill="#003366"/><text x="71" y="377" fill="#1a2940" font-size="8" font-family="Noto Sans">Nashik</text>
                <circle cx="118" cy="373" r="5" fill="#f15a22"/><text x="127" y="377" fill="#1a2940" font-size="8" font-family="Noto Sans">Amravati</text>
                <circle cx="182" cy="373" r="5" fill="#138808"/><text x="191" y="377" fill="#1a2940" font-size="8" font-family="Noto Sans">Nagpur</text>
                <circle cx="240" cy="373" r="5" fill="#ff9933"/><text x="249" y="377" fill="#1a2940" font-size="8" font-family="Noto Sans">Chh. Sambhaji</text>
                <circle cx="325" cy="373" r="5" fill="#0070c0"/><text x="334" y="377" fill="#1a2940" font-size="8" font-family="Noto Sans">Pune</text>
                <circle cx="374" cy="373" r="5" fill="#6f42c1"/><text x="383" y="377" fill="#1a2940" font-size="8" font-family="Noto Sans">Konkan</text>
                <circle cx="426" cy="373" r="5" fill="#dc3545"/><text x="435" y="377" fill="#1a2940" font-size="8" font-family="Noto Sans">Mumbai</text>
              </svg>
            </div>
          </div>
        </div>
        <div class="panel">
          <div class="panel-header"><span class="panel-title">üì¶ Top Exports ‚Äî Value ¬∑ Share</span><span class="panel-badge">Commodity View</span></div>
          <div class="panel-body" style="padding-top:10px;"><div id="product-list"><div class="loading"><div class="spinner"></div>Loading...</div></div></div>
        </div>
      </div>
    </div>
  </div>

  <div id="view-districts" style="display:none;">
    <div class="panel">
      <div class="panel-header"><span class="panel-title">üèôÔ∏è Districts / UT ‚Äî Export Summary</span><span class="panel-badge" id="district-count-badge">Loading...</span></div>
      <div class="table-wrap">
        <table>
          <thead><tr><th>#</th><th>District</th><th>Region</th><th class="num">Total Apr‚ÄìDec (‚Çπ Mn)</th><th class="num">Dec '25</th><th class="num">Nov '25</th><th class="num">MoM Growth %</th><th class="num">% Share in Total Exports</th></tr></thead>
          <tbody id="district-table-body"><tr><td colspan="8"><div class="loading"><div class="spinner"></div>Loading...</div></td></tr></tbody>
        </table>
      </div>
    </div>
  </div>

  <div id="view-products" style="display:none;">
    <div class="content-grid">
      <div class="left-col">
        <div class="panel">
          <div class="panel-header"><span class="panel-title">üì¶ Top Exports from State ‚Äî Value ¬∑ Share</span><span class="panel-badge">Top 10 Commodities</span></div>
          <div class="panel-body"><div class="chart-wrap" style="height:340px;"><canvas id="chart-products"></canvas></div></div>
        </div>
      </div>
      <div class="right-col">
        <div class="panel">
          <div class="panel-header"><span class="panel-title">Commodity Division ‚Äî Rankings</span><span class="panel-badge">Value ¬∑ Share %</span></div>
          <div class="panel-body" style="padding-top:10px;"><div id="product-list-detail"><div class="loading"><div class="spinner"></div>Loading...</div></div></div>
        </div>
      </div>
    </div>
  </div>
</div>
<div class="footer">Government of Maharashtra ¬∑ Export Trade Dashboard ¬∑ Data Source: Sample.xlsx &nbsp;|&nbsp; <span>FY 2025‚Äì26</span> ¬∑ Apr‚ÄìDec 2025 &nbsp;|&nbsp; For official use only</div>

<script>
const API='http://localhost:5000/api';
let trendChart=null,productChart=null;
const REGION_COLORS={'Nashik Region':'#003366','Amravati Region':'#f15a22','Nagpur Region':'#138808','Chh. Sambhaji Nagar Region':'#ff9933','Pune Region':'#0070c0','Konkan Region':'#6f42c1','Mumbai Region':'#dc3545'};
const COLORS=['#003366','#f15a22','#138808','#ff9933','#0070c0','#6f42c1','#dc3545','#17a2b8','#6c757d','#20c997'];

async function init(){
  document.getElementById('last-updated').textContent='Updated: '+new Date().toLocaleString('en-IN');
  await loadFilters();await loadAll();
}
async function loadFilters(){
  const d=await fetch(`${API}/filters`).then(r=>r.json()).catch(()=>null);
  if(!d)return;
  populateSelect('filter-region',d.regions);populateSelect('filter-district',d.districts);populateSelect('filter-product',d.products);
}
function populateSelect(id,opts){document.getElementById(id).innerHTML=opts.map(o=>`<option value="${o}">${o}</option>`).join('');}
function getFilters(){return{region:document.getElementById('filter-region').value,district:document.getElementById('filter-district').value,product:document.getElementById('filter-product').value};}
function qs(p){return'?'+new URLSearchParams(p).toString();}
async function loadAll(){const f=getFilters();updateBreadcrumb(f);await Promise.all([loadSummary(f),loadTrend(f),loadRegions(f),loadProducts(f),loadDistricts(f),updateTicker(f)]);}
async function applyFilters(){await loadAll();}
function resetFilters(){document.getElementById('filter-region').value='All';document.getElementById('filter-district').value='All';document.getElementById('filter-product').value='All';loadAll();}
function updateBreadcrumb(f){document.getElementById('bc-region').textContent=f.region==='All'?'All Regions':f.region;document.getElementById('bc-district').textContent=f.district==='All'?'All Districts':f.district;}
async function updateTicker(f){
  const r=await fetch(`${API}/regions${qs(f)}`).then(r=>r.json()).catch(()=>[]);
  if(!r.length)return;
  const top=r[0];
  document.getElementById('ticker-text').textContent=`üèÜ Highest Exporting Region: ${top.region} ‚Äî ‚Çπ${fmt(top.total_export)} Mn     |     `+r.map(x=>`${x.region}: ‚Çπ${fmt(x.total_export)} Mn (Share: ${x.share}%,  MoM: ${x.mom_growth>=0?'+':''}${x.mom_growth}%)`).join('     |     ');
}
async function loadSummary(f){
  const d=await fetch(`${API}/summary${qs(f)}`).then(r=>r.json()).catch(()=>null);if(!d)return;
  document.getElementById('kpi-total').textContent='‚Çπ '+fmt(d.total_export);
  document.getElementById('kpi-latest').textContent='‚Çπ '+fmt(d.latest_month);
  document.getElementById('kpi-districts').textContent=d.num_districts;
  document.getElementById('kpi-products').textContent=d.num_products;
  const s=d.mom_growth>=0?'+':'',cls=d.mom_growth>=0?'up':'down',a=d.mom_growth>=0?'‚ñ≤':'‚ñº';
  document.getElementById('kpi-growth-badge').innerHTML=`<div class="kpi-badge ${cls}">${a} ${s}${d.mom_growth}% compared to Nov '25</div>`;
}
async function loadTrend(f){
  const data=await fetch(`${API}/monthly-trend${qs(f)}`).then(r=>r.json()).catch(()=>null);if(!data)return;
  if(trendChart){trendChart.destroy();trendChart=null;}
  const ctx=document.getElementById('chart-trend').getContext('2d');
  const grad=ctx.createLinearGradient(0,0,0,210);grad.addColorStop(0,'rgba(0,51,102,0.18)');grad.addColorStop(1,'rgba(0,51,102,0.01)');
  trendChart=new Chart(ctx,{type:'line',data:{labels:data.map(d=>d.month),datasets:[{label:'Export Value (‚Çπ Mn)',data:data.map(d=>d.value),borderColor:'#003366',backgroundColor:grad,borderWidth:2.5,tension:0.4,fill:true,pointBackgroundColor:'#f15a22',pointBorderColor:'#fff',pointBorderWidth:2,pointRadius:5,pointHoverRadius:7}]},options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{display:false},tooltip:{backgroundColor:'#003366',titleColor:'#fff',bodyColor:'rgba(255,255,255,0.8)',borderColor:'#f15a22',borderWidth:1,padding:10,callbacks:{label:ctx=>'  ‚Çπ '+fmt(ctx.parsed.y)+' Mn'}}},scales:{x:{grid:{color:'#e8eef6'},ticks:{color:'#5a6e88',font:{size:11}}},y:{grid:{color:'#e8eef6'},ticks:{color:'#5a6e88',font:{size:11,family:'Noto Sans Mono'},callback:v=>'‚Çπ'+fmt(v)}}}}});
}
async function loadRegions(f){
  const data=await fetch(`${API}/regions${qs(f)}`).then(r=>r.json()).catch(()=>null);if(!data)return;
  document.getElementById('region-table-body').innerHTML=data.map((r,i)=>{
    const rc=i===0?'top1':i===1?'top2':i===2?'top3':'',gc=r.mom_growth>=0?'pos':'neg',gs=r.mom_growth>=0?'+':'',color=REGION_COLORS[r.region]||'#003366';
    return`<tr><td><span class="rank-badge ${rc}">${i+1}</span></td><td><div style="display:flex;align-items:center;gap:8px;"><div style="width:10px;height:10px;border-radius:2px;background:${color};flex-shrink:0;"></div><span style="font-weight:600;">${r.region}</span></div></td><td class="num" style="font-weight:700;color:#003366;">‚Çπ ${fmt(r.total_export)}</td><td class="num">‚Çπ ${fmt(r.dec_export)}</td><td class="num">‚Çπ ${fmt(r.nov_export)}</td><td class="num"><span class="growth-chip ${gc}">${gs}${r.mom_growth}%</span></td><td class="num"><div class="share-bar-wrap"><div class="share-bar-bg"><div class="share-bar-fill" style="width:${Math.min(r.share,100)}%"></div></div><span style="font-family:'Noto Sans Mono';font-size:11px;min-width:38px;text-align:right;font-weight:700;">${r.share}%</span></div></td></tr>`;
  }).join('');
}
async function loadDistricts(f){
  const data=await fetch(`${API}/districts${qs(f)}`).then(r=>r.json()).catch(()=>null);if(!data)return;
  document.getElementById('district-count-badge').textContent=`${data.length} Districts`;
  document.getElementById('district-table-body').innerHTML=data.map((d,i)=>{
    const rc=i===0?'top1':i===1?'top2':i===2?'top3':'',gc=d.mom_growth>=0?'pos':'neg',gs=d.mom_growth>=0?'+':'',color=REGION_COLORS[d.region]||'#003366';
    return`<tr><td><span class="rank-badge ${rc}">${i+1}</span></td><td style="font-weight:600;">${d.district}</td><td><div style="display:flex;align-items:center;gap:6px;"><div style="width:8px;height:8px;border-radius:2px;background:${color};"></div><span style="color:#5a6e88;font-size:11px;">${d.region}</span></div></td><td class="num" style="font-weight:700;color:#003366;">‚Çπ ${fmt(d.total_export)}</td><td class="num">‚Çπ ${fmt(d.dec_export)}</td><td class="num">‚Çπ ${fmt(d.nov_export)}</td><td class="num"><span class="growth-chip ${gc}">${gs}${d.mom_growth}%</span></td><td class="num"><div class="share-bar-wrap"><div class="share-bar-bg"><div class="share-bar-fill" style="width:${Math.min(d.share*3,100)}%"></div></div><span style="font-family:'Noto Sans Mono';font-size:11px;min-width:38px;text-align:right;font-weight:700;">${d.share}%</span></div></td></tr>`;
  }).join('');
}
async function loadProducts(f){
  const data=await fetch(`${API}/products${qs(f)}`).then(r=>r.json()).catch(()=>null);if(!data)return;
  document.getElementById('product-list').innerHTML=data.slice(0,8).map((p,i)=>`<div class="product-item"><div class="product-color-bar" style="background:${COLORS[i]}"></div><div class="product-name" title="${p.product}">${p.product}</div><div class="product-val">‚Çπ${fmt(p.total_export)} Mn</div><div class="product-share">${p.share}%</div></div>`).join('');
  const dl=document.getElementById('product-list-detail');
  if(dl)dl.innerHTML=data.map((p,i)=>`<div class="product-item"><span class="rank-badge ${i===0?'top1':i===1?'top2':i===2?'top3':''}" style="margin-right:6px;">${i+1}</span><div class="product-color-bar" style="background:${COLORS[i]}"></div><div class="product-name" title="${p.product}">${p.product}</div><div class="product-val">‚Çπ${fmt(p.total_export)}</div><div class="product-share">${p.share}%</div></div>`).join('');
  if(productChart){productChart.destroy();productChart=null;}
  const el=document.getElementById('chart-products');if(!el)return;
  productChart=new Chart(el.getContext('2d'),{type:'bar',data:{labels:data.map(p=>p.product.length>22?p.product.substring(0,22)+'‚Ä¶':p.product),datasets:[{label:'Export Value (‚Çπ Mn)',data:data.map(p=>p.total_export),backgroundColor:COLORS,borderRadius:4,borderSkipped:false}]},options:{indexAxis:'y',responsive:true,maintainAspectRatio:false,plugins:{legend:{display:false},tooltip:{backgroundColor:'#003366',titleColor:'#fff',bodyColor:'rgba(255,255,255,0.8)',borderColor:'#f15a22',borderWidth:1,padding:10,callbacks:{label:ctx=>'  ‚Çπ '+fmt(ctx.parsed.x)+' Mn ‚Äî '+data[ctx.dataIndex].share+'% share'}}},scales:{x:{grid:{color:'#e8eef6'},ticks:{color:'#5a6e88',font:{size:10,family:'Noto Sans Mono'},callback:v=>'‚Çπ'+fmt(v)}},y:{grid:{display:false},ticks:{color:'#1a2940',font:{size:11}}}}}});
}
function switchView(view,btn){
  document.querySelectorAll('.view-tab').forEach(t=>t.classList.remove('active'));btn.classList.add('active');
  document.getElementById('view-overview').style.display=view==='overview'?'':'none';
  document.getElementById('view-districts').style.display=view==='districts'?'':'none';
  document.getElementById('view-products').style.display=view==='products'?'':'none';
  if(view==='products')setTimeout(()=>loadProducts(getFilters()),50);
}
function fmt(n){if(n===undefined||n===null)return'0';return Number(n).toLocaleString('en-IN');}
window.addEventListener('DOMContentLoaded',()=>{
  init().catch(()=>{document.getElementById('ticker-text').textContent='‚ö†Ô∏è Cannot connect to Python API at localhost:5000 ‚Äî Please run: python app.py in the backend folder';});
});
</script>
</body>
</html>
